<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ===== PAGE DE CONNEXION ===== -->
    <template id="login" inherit_id="web.login" name="Login with reCAPTCHA">
        <xpath expr="//form" position="after">
            <!-- IntÃ©gration reCAPTCHA v2 -->
            <script src="https://www.google.com/recaptcha/api.js" async="async" defer="defer"/>

            <div class="form-group" style="margin: 15px 0;">
                <div class="g-recaptcha" data-sitekey="6Lccex4rAAAAAObaQPCJ9ECIoNMdG8yOXJTHXv2x"/>
                <div id="recaptcha-error" style="color: red; display: none;">
                    Veuillez cocher la case "Je ne suis pas un robot".
                </div>
            </div>

            <script><![CDATA[
                function validateCaptcha() {
                    const response = grecaptcha.getResponse();
                    if (!response) {
                        document.getElementById('recaptcha-error').style.display = 'block';
                        return false;
                    }
                    return true;
                }

                document.addEventListener('DOMContentLoaded', function() {
                    const form = document.querySelector('.oe_login_form');
                    if (form) {
                        form.addEventListener('submit', function(e) {
                            if (!validateCaptcha()) {
                                e.preventDefault();
                            }
                        });
                    }
                });
            ]]></script>
        </xpath>
    </template>

    <!-- ===== PAGE D'INSCRIPTION ===== -->
    <template id="signup" inherit_id="auth_signup.signup" name="Signup with reCAPTCHA">
        <xpath expr="//form" position="after">
            <script src="https://www.google.com/recaptcha/api.js" async="async" defer="defer"/>

            <div class="form-group" style="margin: 15px 0;">
                <div class="g-recaptcha" data-sitekey="6Lccex4rAAAAAObaQPCJ9ECIoNMdG8yOXJTHXv2x"/>
                <div id="recaptcha-error-signup" style="color: red; display: none;">
                    Veuillez cocher la case "Je ne suis pas un robot".
                </div>
            </div>

            <script><![CDATA[
                document.addEventListener('DOMContentLoaded', function() {
                    const form = document.querySelector('.oe_signup_form');
                    if (form) {
                        form.addEventListener('submit', function(e) {
                            const response = grecaptcha.getResponse();
                            if (!response) {
                                e.preventDefault();
                                document.getElementById('recaptcha-error-signup').style.display = 'block';
                            }
                        });
                    }
                });
            ]]></script>
        </xpath>
    </template>
</odoo>